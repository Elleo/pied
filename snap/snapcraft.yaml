name: pied
base: core22
version: '0.1.2'
summary: Pied makes it simple to install and manage text-to-speech voices.
description: |
  Pied installs and configures the Piper neural text-to-speech engine to
  work with Speech Dispatcher. It can then be used to download and manage
  different voices.

grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict

apps:
  pied:
    command: pied
    extensions: [gnome]
    plugs:
      - speech-dispatcher-config
      - process-control
      - network
      - audio-playback
plugs:
  speech-dispatcher-config:
    interface: personal-files
    read:
      - $HOME/.config/speech-dispatcher
    write:
      - $HOME/.config/speech-dispatcher


parts:
  pied:
    source: .
    plugin: flutter
    flutter-target: lib/main.dart
    build-packages: [curl, libgstreamer1.0-dev, libgstreamer-plugins-base1.0-dev, libgstreamer-plugins-good1.0-dev]
    stage-packages: [psmisc, speech-dispatcher, libaudio2, libsndio7.0, libgstreamer1.0-0, libgstreamer-plugins-base1.0-0, libgstreamer-plugins-good1.0-0, libgstreamer-plugins-bad1.0-0]
    override-pull: |
      set -eux
      rm -rf $SNAPCRAFT_PROJECT_DIR/build
      snapcraftctl pull
    build-attributes:
      - enable-patchelf

